@base=https://burlive.ru/api/v2

### Health
GET {{base}}/health

### Auth verify (hash нужно реальное) — ответ содержит isFirstOpen
GET {{base}}/auth/verify?user=%7B%22id%22%3A12345%7D&start_param=utm_source%3Dvk%26utm_campaign%3Dlaunch&auth_date=1735862400&hash=REAL_HASH

### Events
POST {{base}}/events
Content-Type: application/json

{
  "userId": 12345,
  "name": "paywall_view",
  "properties": { "utm_source": "vk" }
}

### Create payment
POST {{base}}/payments/create
Content-Type: application/json

{
  "userId": "12345",
  "product": "monthly",
  "returnUrl": "https://burlive.ru/payment/success",
  "description": "Подписка на месяц - BurLive"
}

### Get payment status
GET {{base}}/payments/status?paymentId=23d93cac-000f-5000-8000-126628f15141

### Payments webhook
POST {{base}}/payments/webhook
Content-Type: application/json
x-idempotency-key: ik_1

{
  "provider": "mock",
  "providerId": "p_1",
  "userId": 12345,
  "product": "monthly",
  "amount": 7900,
  "currency": "RUB",
  "status": "succeeded"
}

### YooKassa Webhook (local dev)
POST http://localhost:7777/api/v2/payments/webhook/yookassa
Content-Type: application/json
Idempotence-Key: demo-idem-key-123

{
  "event": "payment.succeeded",
  "object": {
    "id": "23d93cac-000f-5000-8000-126628f15141",
    "amount": { "value": "100.00", "currency": "RUB" },
    "metadata": { "userId": "test-user-123", "product": "monthly" }
  }
}

### Entitlements
GET {{base}}/entitlements/12345

### Promo redeem
POST {{base}}/promo/redeem
Content-Type: application/json

{
  "userId": 12345,
  "promoId": "BURI79"
}

### Content
GET {{base}}/content/onboarding
GET {{base}}/content/lesson1?userId=12345
GET {{base}}/content/paywall?userId=12345

### Content - Public API
GET {{base}}/content/modules?userId=12345&level=A0
GET {{base}}/content/lessons?userId=12345&moduleRef=a0.travel
GET {{base}}/content/lessons/a0.travel.001?userId=12345

### Admin Content - create module
POST {{base}}/admin/content/modules
Content-Type: application/json

{
  "userId": 12345,
  "moduleRef": "a0.travel",
  "level": "A0",
  "title": "Travel A0",
  "description": "Basics for travel situations",
  "tags": ["travel"],
  "order": 1,
  "published": true
}

### Admin Content - list modules
GET {{base}}/admin/content/modules?userId=12345&level=A0

### Admin Content - update module
PATCH {{base}}/admin/content/modules/a0.travel
Content-Type: application/json

{
  "userId": 12345,
  "title": "Travel A0 (Updated)",
  "published": true
}

### Admin Content - create lesson
POST {{base}}/admin/content/lessons
Content-Type: application/json

{
  "userId": 12345,
  "moduleRef": "a0.travel",
  "lessonRef": "a0.travel.001",
  "title": "At the airport",
  "description": "Check-in, passport control, boarding",
  "estimatedMinutes": 12,
  "order": 1,
  "published": true,
  "tasks": [
    {
      "ref": "a0.travel.001.t1",
      "type": "choice",
      "data": {
        "question": "How do you greet the officer?",
        "options": ["Hello", "Bye", "Thanks"],
        "correctIndex": 0
      }
    },
    {
      "ref": "a0.travel.001.t2",
      "type": "gap",
      "data": {
        "text": "May I see your ____?",
        "answer": "passport",
        "hints": ["document", "travel id"]
      }
    }
  ]
}

### Admin Content - list lessons
GET {{base}}/admin/content/lessons?userId=12345&moduleRef=a0.travel

### Admin Content - update lesson
PATCH {{base}}/admin/content/lessons/a0.travel.001
Content-Type: application/json

{
  "userId": 12345,
  "title": "Airport basics",
  "published": true
}

### Progress - start session
POST {{base}}/progress/sessions/start
Content-Type: application/json

{
  "userId": 12345,
  "moduleRef": "a0.travel",
  "lessonRef": "a0.travel.001",
  "source": "home"
}

### Progress - submit-answer (t1)
POST {{base}}/progress/submit-answer
Content-Type: application/json
Idempotency-Key: {{idempotencyKey1}}

{
  "lessonRef": "a0.travel.001",
  "taskRef": "a0.travel.001.t1",
  "userAnswer": "Hello",
  "lastTaskIndex": 0,
  "isLastTask": false
}

### Progress - submit-answer (t2, last)
POST {{base}}/progress/submit-answer
Content-Type: application/json
Idempotency-Key: {{idempotencyKey2}}

{
  "lessonRef": "a0.travel.001",
  "taskRef": "a0.travel.001.t2",
  "userAnswer": "passport",
  "lastTaskIndex": 1,
  "isLastTask": true
}

### Progress - XP and stats view
GET {{base}}/progress/xp/12345?limit=50
GET {{base}}/progress/stats/daily/12345?limit=14

### Analytics
GET {{base}}/admin/analytics/funnel?utm_source=vk
GET {{base}}/admin/analytics/revenue?utm_source=vk

### Profile
GET {{base}}/profile/12345

PATCH {{base}}/profile
Content-Type: application/json

{
  "userId": 12345,
  "firstName": "Dashi",
  "languageCode": "ru"
}

### Onboarding: save learning goals
POST {{base}}/profile/learning-goals
Content-Type: application/json

{
  "userId": 12345,
  "goals": ["work_career", "travel"]
}

### Onboarding: save daily goal
POST {{base}}/profile/daily-goal
Content-Type: application/json

{
  "userId": 12345,
  "dailyGoalMinutes": 10,
  "allowsNotifications": true
}

### Onboarding: save reminder settings
POST {{base}}/profile/reminder-settings
Content-Type: application/json

{
  "userId": 12345,
  "reminderSettings": {
    "enabled": true,
    "time": "evening",
    "allowsNotifications": true
  }
}

### Complete onboarding
PATCH {{base}}/profile/onboarding/complete
Content-Type: application/json

{
  "userId": 12345,
  "proficiencyLevel": "beginner"
}

### Leads: bot_start (from /start)
POST {{base}}/leads/bot_start
Content-Type: application/json

{
  "userId": 12345,
  "utm": { "utm_source": "vk", "utm_campaign": "launch" },
  "promoId": "BURI79"
}

